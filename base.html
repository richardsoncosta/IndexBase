<!DOCTYPE html>
<html>

<head>
    <title>Base de conhecimentos</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="estilo.css">
    <script>
        function checkAuth() {
            const user = localStorage.getItem('user');
            const timestamp = localStorage.getItem('timestamp');

            // Verifica se o usuário já está autenticado e se a autenticação ainda é válida (4 horas)
            if (user && timestamp && (Date.now() - timestamp < 4 * 60 * 60 * 1000)) {
                return true; // Usuário já autenticado
            }

            // Loop para solicitar credenciais até que o usuário acerte ou cancele
            while (true) {
                const username = prompt("Digite o nome de usuário:");
                if (username === null) {
                    // Usuário cancelou o prompt
                    alert("Autenticação cancelada.");
                    return false;
                }

                const password = prompt("Digite a senha:");
                if (password === null) {
                    // Usuário cancelou o prompt
                    alert("Autenticação cancelada.");
                    return false;
                }

                // Verifica se as credenciais estão corretas
                if (username === "SUPERVISOR" && password === "123456") {
                    localStorage.setItem('user', username); // Armazena o usuário
                    localStorage.setItem('timestamp', Date.now()); // Armazena o timestamp
                    return true; // Autenticação bem-sucedida
                } else {
                    alert("Usuário ou senha incorretos. Tente novamente.");
                }
            }
        }

        // Verifica a autenticação ao carregar a página
        if (!checkAuth()) {
            window.location.href = "about:blank"; // Redireciona para uma página em branco se a autenticação falhar
        }

        // Função para mostrar/ocultar o código
        function toggleCode(button) {
            const codeElement = button.previousElementSibling;
            if (codeElement.style.display === "none" || codeElement.style.display === "") {
                codeElement.style.display = "block";
                button.textContent = "Mostrar menos";
            } else {
                codeElement.style.display = "none";
                button.textContent = "Mostrar mais";
            }
        }

        // Função para buscar conteúdo
        function buscarConteudo() {
            const termo = document.getElementById("inputBusca").value.toLowerCase(); // Obtém o termo de busca
            const postagens = document.querySelectorAll(".postagem"); // Seleciona todas as postagens

            postagens.forEach(postagem => {
                const titulo = postagem.querySelector("h4").textContent.toLowerCase();
                const descricao = postagem.querySelector(".descricao-sql").textContent.toLowerCase();
                const codigo = postagem.querySelector(".codigo").textContent.toLowerCase();

                // Verifica se o termo de busca está no título, descrição ou código
                if (titulo.includes(termo) || descricao.includes(termo) || codigo.includes(termo)) {
                    postagem.style.display = ""; // Mostra a postagem se contiver o termo
                } else {
                    postagem.style.display = "none"; // Oculta a postagem se não contiver o termo
                }
            });
        }
    </script>
</head>
<body>
    <div id="area-cabecalho">
        <div id="area-logo">
            <h1>Suporte</h1>
        </div>
        <div id="area-menu">
            <a href="index.html">Home</a>
            <a class="selecionado" href="base.html">Base de Conhecimentos</a>
            <a href="tutoriais.html">Tutoriais</a>
            <a href="sql.html">SQLs</a>
            <a href="downloads.html">Downloads</a>
        </div>
    </div>

    <div id="area-principal">
        <div id="area-sql">
            <div>
                <h2>Base de conhecimentos</h2>
                <br>
                <span class="descricao">Encontre erros mapeados e suas soluções rápidas</span>
                <br><br><br>
                <p>Nesta seção você vai encontrar um acervo de erros documentados e suas soluções de uso rotineiro do suporte para as mais diversas situações.</p>
                <br>
                <div>
                    <input type="text" id="inputBusca" placeholder="Buscar conteúdo..." oninput="buscarConteudo()">
                    <p class="buscar-conteudo">Use a barra acima para buscar conteúdo.</p>
                </div>
                <br><br><br>

                <!-- Início das postagens -->
                <div class="postagem">
                    <div class="postagem-fretedeloja"> <!-- Conteúdo da div que será mostrado pelo primeiro botão -->
                        <h4>1 - Contingência: Schema XML: The 'http://www.portalfiscal.inf.br/nfe.cAut' element is invalid - The value "" is invalid according to its datatype 'String' - The Pattern constraint</h4>
                        <br>
                        <span class="descricao-sql">Erro no XML, existe algum caractere que não é aceito pela SEFAZ no campo de autorização manual, que o frentista informa para finalizar uma venda em cartão manual.</span>
                        <br><br>
                    </div>

                    <pre class="codigo"> <!-- Conteúdo pré-formatado que será mostrado pelo segundo botão -->
                        Para correção:
                        1 - No banco do PAF > tabela VENDA_FECHAMENTO_CRT > coluna CARTAO_AUTORIZACAO > Alterar o valor nesse campo por qualquer número natural > comitar.
                        (Caso não seja necessário para o cliente essa função de digitar o número de autorização para baixar a venda, podemos desativar a função e evitar futuros casos.)

                        2 - Para desativar a função caso o cliente não use (Perguntar se usa) > Acessar > "Configurações PDV" > aba TEF > desmarcar flag canto inferior esquerdo > solicitação digitação manual para cartão.
                    </pre>

                    <button onclick="toggleCode('postagem-fretedeloja', this)">SUPORTE FRENTE DE LOJA</button>
                    <button onclick="toggleCode('codigo', this)">Mostrar mais</button>
                    <br><br>
                    <hr>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleCode(elementClass, button) {
            const element = document.querySelector(`.${elementClass}`); // Seleciona o elemento pela classe
            if (element.classList.contains('visible')) {
                element.classList.remove('visible'); // Oculta o conteúdo
                button.textContent = elementClass === 'postagem-fretedeloja' ? 'SUPORTE FRENTE DE LOJA' : 'Mostrar mais';
            } else {
                element.classList.add('visible'); // Exibe o conteúdo
                button.textContent = elementClass === 'postagem-fretedeloja' ? 'OCULTAR FRENTE DE LOJA' : 'Mostrar menos';
            }
        }
    </script>
</body>
</html>
